# {{node_name}}

{{description}}

## Quick Reference

| Item | Value |
|------|-------|
| Type | Rust |
| Build | `cargo build --release` |
| Run | `bubbaloop node start {{node_name}}` |
| Logs | `bubbaloop node logs {{node_name}} -f` |

## File Structure

```
{{node_name}}/
├── AGENTS.md       # This file - AI agent context
├── node.yaml       # Daemon manifest (name, type, command)
├── config.yaml     # Runtime configuration
├── Cargo.toml      # Rust dependencies
└── src/
    ├── main.rs     # Entry point (CLI args, shutdown handling)
    └── node.rs     # Main implementation (EDIT THIS)
```

## How to Modify

### Adding a New Zenoh Publisher
Edit `src/node.rs`:
```rust
// Topics follow scoped pattern: bubbaloop/{scope}/{machine_id}/{{node_name}}/{resource}
// The topic_prefix is built automatically from BUBBALOOP_SCOPE and BUBBALOOP_MACHINE_ID
let my_topic = format!("{}/my_topic", topic_prefix);
let publisher = session.declare_publisher(&my_topic).await?;

// In the run loop, publish data
publisher.put(serde_json::to_vec(&data)?).await?;
```

### Adding a Subscriber
```rust
// Subscribe using scoped pattern (wildcards discover across machines)
let subscriber = session.declare_subscriber("bubbaloop/**/other_node/output").await?;
// Handle in select! loop
```

### Changing Configuration
Edit `config.yaml`:
```yaml
publish_topic: "output"  # Appended to bubbaloop/{scope}/{machine_id}/{{node_name}}/
rate_hz: 10.0  # Adjust publish rate
```

## Zenoh Topics

All topics follow the scoped pattern: `bubbaloop/{scope}/{machine_id}/{{node_name}}/{resource}`

| Topic Suffix | Direction | Format | Description |
|--------------|-----------|--------|-------------|
| `output` | Publish | JSON | Main output data |
| `schema` | Queryable | Protobuf | FileDescriptorSet (if protos exist) |
| `manifest` | Queryable | JSON | Node self-description contract |
| `health` | Queryable | JSON | Node health status |
| `config` | Queryable | JSON | Read-only configuration |

Data published to these topics is:
- Visible in the Bubbaloop Dashboard
- Available to other nodes on the Zenoh network
- Persisted if a recorder node is running

## Dependencies

This node has no dependencies on other nodes. To add dependencies, specify in `node.yaml`:
```yaml
depends_on:
  - other-node-name
```
